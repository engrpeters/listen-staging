{"version":3,"sources":["meteor://ðŸ’»app/imports/api/links/methods-release.js","meteor://ðŸ’»app/imports/api/links/methods.js","meteor://ðŸ’»app/imports/api/collections.js","meteor://ðŸ’»app/imports/api/publications.js","meteor://ðŸ’»app/imports/startup/both/index.js","meteor://ðŸ’»app/imports/startup/server/fixtures.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/imports/startup/server/register-api.js","meteor://ðŸ’»app/imports/startup/server/searchIndexes.js","meteor://ðŸ’»app/models/user.js","meteor://ðŸ’»app/server/indexer.js","meteor://ðŸ’»app/server/main.js"],"names":["Releases","Spaces","module","link","v","NonEmptyString","Match","Where","x","check","String","length","Meteor","methods","create_release","release","userId","ObjectIncluding","name","label","cover","url","id","tracks","contributors","Array","explicit","file","Object","genre","languageCode","recording_year","Number","containsLyrics","version","origin","audio","format","deliveryOptions","confirmed","Boolean","status","recieved","Date","pending","approved","delivered","type","proposedReleaseDate","moment","add","recieved_at","space","findOne","owner","users","Error","insert","err","create_space","space_name","Random","created_at","artist_name","update","_id","$set","Tracks","Playlists","Albums","Activities","Artists","Genres","Youtube","UserTracks","People_1","ytdl","Npm","require","cloudinary","config","cloud_name","api_key","api_secret","formatImage","formats","formatted","map","el","inde","width","crop","secure","artist","stage_name","bio","Maybe","full_name","dob","gender","country","ipi","isni","notes","get_full_track","track","tr","fields","album","title","track_number","featuring_artists","duration","call","forEach","e","i","assign","create_playlist","playlist","description","data","market","public","plays","Integer","fp","verified","art","author","href","author_userId","delete_playlist","remove","recordPlay","media","where","recentPlay","item","date","$push","recently_played","$each","track_play","listened","user_track","seconds_listened","activity","usertrack","$inc","auto","returnPlaylist","last_updated","ind","added_at","push","images","play","return_playlist_short","getUserPlaylists","playlists","p","find","fetch","element","returnPublicPlaylists","region","$ne","$slice","add_track_to_playlist","pl","remove_from_playlist","$pull","res","returnAlbumName","get_user_fullName","po","tnid","user","firstName","lastName","artist_short_info","og","add_to_library","libItem","tra","library","add_artist_to_library","delete_user_track","library_recently_added","pipeline","$match","$unwind","$group","$last","$first","$project","$sort","rawCollection","aggregate","toArray","get_album_tracks","filter","results","library_songs","library_albums","return_album","release_date","artists","album_art","genres","album_type","Promise","all","want","height","return_album_info","get_albums","ids","albums","$in","index","release_year","return_images","return_album_full","sort","add_you_to_library","imgurl","notexists","stream","v2","uploader","upload_stream","resource_type","bindEnvironment","error","result","secure_url","yout","pipe","get_artist","profile","get_artists","get_artist_lr","alb","get_artist_topsongs","lim","search","albumTracks","limit","artistTracks","concat","apply","arr2","toRe","a","b","mapo","get_artist_albums","albs","get_artist_sm","toReturn","$all","image","remove_from_library","like_item","likes","dislike_item","add_artist","followers","$nin","remove_artist","more_by_artists","add_user_track","original","obj","image_url","replace","toLowerCase","user_album","$position","uploaded_by","uploaded_at","console","log","add_to_user_library","export","Markets","Discover","Mongo","Collection","ReactiveAggregate","publish","sub","observeHandle","observeChanges","added","changed","removed","toreturn","emails","email","birthday","avatar","sm","al","ts","lr","ready","num","subHandle","$gte","getTime","singles","ft","self","totalPlays","$sum","$limit","position","disco1","clientCollection","space_id","Router","route","get","response","setHeader","$regex","RegExp","params","end","JSON","stringify","SharedTokens","accountsDomain","settings","ourUrls","accounts","NBAccounts","DDP","connect","subscribe","connection","_suppressSameNameError","Accounts","registerLoginHandler","options","it","valid","LT","onLogin","attempt","timestamp","now","gid","methodArguments","slice","token","_getLoginToken","gids","tokens","hashedToken","validateLoginAttempt","default_server","method_handlers","conn","_setLoginToken","destroyToken","_successfulLogout","setUserId","elasticsearch","client","Client","host","elasticserver","getUnique","arr","comp","unique","final","indexOf","search_songs","que","searchText","lastWord","trim","split","splice","query","bool","must","dis_max","queries","match_phrase","slop","match","boost","prefix","nested","path","term","body","hits","doc","_source","ta","search_albums","sear","should","match_phrase_prefix","wow","nonsense","search_artists","search_playlists","$text","$search","USER","putMapping","indices","create","mappings","properties","keyword","text","created_on","include_in_parent","album_id","resp","FIELDS_TO_INCLUDE","arti","run","MongoInternals","Busboy","request","db1","RemoteCollectionDriver","accountsDB","reconnectTries","reconnectInterval","onConnection","createAccount","r","services","WebApp","connectHandlers","use","req","next","gr","method","busboy","headers","on","fieldname","filename","encoding","mimetype","makeid","cloudinary_stream","public_id","folder","ima","write","characters","charactersLength","charAt","Math","floor","random"],"mappings":"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","file":"/app.js","sourcesContent":["import { Releases, Spaces } from \"../collections\";\n\nconst NonEmptyString = Match.Where(x => {\n  check(x, String);\n  return x.length > 0;\n});\n\nMeteor.methods({\n  create_release(release) {\n    if (!this.userId) {\n      return;\n    }\n    check(\n      release,\n      Match.ObjectIncluding({\n        name: NonEmptyString,\n        label: String,\n        cover: Match.ObjectIncluding({\n          url: String,\n          id: String\n        }),\n        tracks: [\n          Match.ObjectIncluding({\n            contributors: Array,\n            explicit: String,\n            file: Object,\n            genre: String,\n            languageCode: String,\n            recording_year: Number,\n            containsLyrics: String,\n            version: String,\n            origin: String,\n\n            audio: Match.ObjectIncluding({\n              format: String,\n              url: String,\n              id: String\n            })\n          })\n        ],\n\n        deliveryOptions: Match.ObjectIncluding({\n          confirmed: Boolean\n        }),\n        languageCode: String,\n        genre: String\n      })\n    );\n    release.status = {\n      recieved: new Date(),\n      pending: true,\n      approved: null,\n      delivered: \"\"\n    };\n    release.type =\n      release.tracks.length < 3\n        ? \"Single\"\n        : release.tracks.length <= 6\n          ? \"E.P\"\n          : \"Album\";\n\n    if (!release.deliveryOptions.proposedReleaseDate) {\n      release.deliveryOptions.proposedReleaseDate = moment()\n        .add(3, \"days\")\n        .format(\"YYYY-MM-DD\");\n\n    }\n    release.deliveryOptions.recieved_at = moment().format('YYYY-MM-DD')\n    release.recieved_at = new Date()\n\n\n    let space = Spaces.findOne(\n      { owner: this.userId },\n      //  { fields: { space: 1, _id: 0 } }\n    )\n    if (!space) {\n      space = Meteor.users.findOne({ 'space.owner': this.userId }).space\n    }\n    if (space) {\n      release.space = space;\n    } else {\n      throw new Meteor.Error(\"How come you don't have a space\");\n\n    }\n    try {\n      Releases.insert(release);\n    } catch (err) {\n      throw new Meteor.Error(\"Error creating release\");\n    }\n  },\n  create_space(space_name) {\n    check(space_name, String);\n    if (!this.userId) {\n      throw new Meteor.Error(\"no-user\", 404, \"Are you logged in?\");\n    } else {\n      var space = {\n        id: Random.id(17),\n        created_at: new Date(),\n        artist_name: space_name,\n        owner: this.userId\n\n      };\n\n      Meteor.users.update({ _id: this.userId }, { $set: { space: space } });\n      Spaces.insert(space)\n    }\n  }\n});\n","// Methods related to links\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport \"./methods-release\";\nvar ytdl = Npm.require(\"ytdl-core\");\ncloudinary = Npm.require(\"cloudinary\");\ncloudinary.config({\n  cloud_name: \"neighborhood\",\n  api_key: \"266855682648229\",\n  api_secret: \"snPAQH1F1mQZMXkg0PMbGSPtq80\"\n});\n\nimport {\n  Tracks,\n  Playlists,\n  Albums,\n  Activities,\n  Artists,\n  Genres,\n  Youtube,\n  UserTracks\n} from \"../collections.js\";\nimport { People_1 } from \"../../startup/server/register-api\";\n//import { People_1 } from \"../../../server/main.js\";\n//People_1\nconst NonEmptyString = Match.Where(x => {\n  check(x, String);\n  return x.length > 0;\n});\n\nconst formatImage = (id, formats) => {\n  let formatted = formats.map((el, inde) => {\n    return {\n      url: cloudinary.url(id, {\n        width: el,\n        crop: \"fit\",\n        secure: true\n      }),\n      width: el\n    };\n  });\n  return formatted;\n};\nMeteor.methods({\n  \"artist.add\"(artist) {\n    check(artist, {\n      type: String,\n      stage_name: String,\n      bio: Match.Maybe({\n        full_name: Match.Maybe(String),\n        dob: Match.Maybe(String),\n        gender: Match.Maybe(String),\n        origin: Match.Maybe(String),\n        country: Match.Maybe(String)\n      }),\n      ipi: Match.Maybe(String),\n      isni: Match.Maybe(String),\n      notes: Match.Maybe(String),\n      genre: [String]\n    });\n    return Artists.insert(artist);\n  },\n  get_full_track(id) {\n    check(id, String);\n    var track = {};\n    var tr = Tracks.findOne(\n      { _id: id },\n      {\n        fields: {\n          _id: 1,\n          album: 1,\n          title: 1,\n          explicit: 1,\n          track_number: 1,\n          featuring_artists: 1,\n          languageCode: 1,\n          recording_year: 1,\n          type: 1,\n          version: 1,\n          formats: 1,\n          duration: 1\n        }\n      }\n    );\n\n    if (tr && tr._id) {\n      track.album = Meteor.call(\"return_album\", tr.album);\n      tr.featuring_artists.forEach((e, i) => {\n        let v = Meteor.call(\"artist_short_info\", e);\n        tr.featuring_artists[i] = v;\n      });\n      return Object.assign(tr, track);\n    } else {\n    }\n  },\n  create_playlist(playlist) {\n    check(this.userId, String);\n    check(playlist, {\n      description: Match.Maybe(String),\n      data: [Object],\n      name: NonEmptyString,\n      market: NonEmptyString,\n      public: Boolean,\n      plays: Match.Integer\n    });\n\n    if (this.userId == \"tnm\" || this.userId == \"listen\") {\n      var fp = Object.assign(\n        {\n          _id: Random.id(),\n          verified: true,\n          art: \"\",\n          type: \"playlist\",\n          author: \"Listen\",\n          created_at: new Date()\n        },\n        playlist\n      );\n    } else {\n      var fp = Object.assign(\n        {\n          _id: Random.id(),\n          verified: false,\n          art: \"\",\n          type: \"playlist\",\n          author: Meteor.call(\"get_user_fullName\", this.userId),\n          created_at: new Date()\n        },\n        playlist\n      );\n    }\n    fp.href = fp.type + \"/\" + fp._id;\n    fp.author_userId = this.userId;\n    Playlists.insert(fp);\n  },\n  delete_playlist(id) {\n    check(id, String);\n    var userId = Playlists.findOne(\n      { _id: id },\n      { fields: { author_userId: 1 } }\n    );\n    if (userId) {\n      userId = userId.author_userId;\n    }\n    if (userId == this.userId) {\n      Playlists.remove({ _id: id });\n    } else {\n      throw new Meteor.Error(\"not-yours\");\n    }\n  },\n  //record track play activities\n  recordPlay(media, where) {\n\n    check(\n      media,\n      Match.ObjectIncluding({\n        _id: String\n      })\n    );\n    check(\n      where,\n      Match.ObjectIncluding({\n        _id: String\n      })\n    );\n\n    let userId = this.userId;\n    if (where._id) {\n      where.id = where._id\n    }\n    // delete where.data\n    var recentPlay = {\n      _id: Random.id(),\n      item: {\n        title: media.title,\n        id: media._id || media.id,\n        _id: media._id || media.id,\n        type: media.type ? media.type : \"track\",\n        duration: media.duration,\n        formats: media.formats,\n        explicit: media.explicit,\n        featuring_artists: media.featuring_artists,\n        album: typeof (media.album) == \"string\" ? Meteor.call('return_album_info', media.album) : media.album\n        //    where.auto_playlist ? where : typeof (media.album) == \"string\" ? Meteor.call('return_album', media.album) : media.album\n\n      },\n      where: where.type == 'playlist' ? where : typeof (media.album) === 'string' ? Meteor.call('return_album_info', media.album) : media.album,\n      date: new Date()\n    };\n    if (userId) {\n      Meteor.users.update(\n        { _id: userId },\n        { $push: { recently_played: { $each: [recentPlay] } } }\n      );\n    }\n  }, track_play(media, where, listened) {\n\n    check(\n      media,\n      Match.ObjectIncluding({\n        _id: String\n      })\n    );\n    check(\n      where,\n      Match.ObjectIncluding({\n        _id: String\n      })\n    );\n\n    if (media.user_track) {\n      return\n    }\n    let userId = this.userId;\n    var recentPlay = {\n      _id: Random.id(),\n      item: {\n        title: media.title,\n        id: media._id || media.id,\n        type: media.type ? media.type : \"track\",\n        seconds_listened: listened\n      },\n      album: media.album.id ? Meteor.call('return_album_info', media.album.id) : media.album ? Meteor.call('return_album_info', media.album) : where,\n\n    };\n    var activity = Object.assign(\n      { date: new Date(), userId: userId, name: \"listened to\" },\n      recentPlay\n    );\n    if (!media.usertrack) {\n\n\n      Tracks.update({ _id: media._id }, { $inc: { plays: 1 } });\n    }\n    if (where.type == \"playlist\" && where.auto != true) {\n      Playlists.update({ _id: where._id }, { $inc: { plays: 1 } });\n    }\n\n    Activities.insert(activity);\n  },\n  returnPlaylist(id) {\n    check(id, String);\n    var data = [];\n    var playlist = Playlists.findOne(\n      { _id: id },\n      {\n        fields: {\n          last_updated: 1,\n          author_userId: 1,\n          name: 1,\n          art: 1,\n          description: 1,\n          data: 1,\n          author: 1,\n          type: 1,\n          public: 1\n        }\n      }\n    );\n\n    if (playlist.data && playlist.data.length)\n      playlist.data.forEach((el, ind) => {\n        var track = Meteor.call(\"get_full_track\", el._id);\n        if (track) {\n          delete track.track_number;\n          delete track.plays;\n          delete track.added_at;\n\n          data.push(track);\n        } else {\n          throw new Meteor.Error('no Track')\n        }\n      });\n    if (playlist.art) {\n      playlist.images = Meteor.call(\"return_images\", playlist.art);\n    } else {\n      playlist.images = data[0] ? data[0].album.images : [];\n    }\n    //   delete playlist.data;\n    playlist.href = playlist.type + \"/\" + playlist._id;\n    var play = Object.assign(playlist, { data: data });\n    return play;\n\n  },\n  return_playlist_short(id) {\n    check(id, String);\n    var playlist = Playlists.findOne(\n      { _id: id },\n      {\n        fields: {\n          last_updated: 1,\n          author_userId: 1,\n          name: 1,\n          art: 1,\n          description: 1,\n          author: 1,\n          type: 1,\n          public: 1,\n          data: 1\n        }\n      }\n    );\n    var id = playlist.data.length ? playlist.data[0]._id : false;\n    if (id) {\n      var track = Meteor.call(\"get_full_track\", id);\n      var images = track ? track.album.images : [];\n    }\n\n    playlist.href = playlist.type + \"/\" + playlist._id;\n    if (playlist.art) {\n      playlist.images = Meteor.call(\"return_images\", playlist.art);\n    } else {\n      playlist.images = images ? images : [];\n    }\n    return playlist;\n  },\n  getUserPlaylists() {\n    if (this.userId) {\n      check(this.userId, String);\n      let playlists = [];\n      let p = Playlists.find(\n        { author_userId: this.userId },\n        { fields: { _id: 1 } }\n      ).fetch();\n      p.forEach(element => {\n        playlists.push(Meteor.call(\"return_playlist_short\", element._id));\n      });\n      return playlists;\n    }\n  },\n  returnPublicPlaylists(region, verified) {\n    check(region, String);\n    check(verified, Boolean);\n    let playlists = [];\n    let p = Playlists.find(\n      { author_userId: { $ne: this.userId }, public: true, market: region },\n      { fields: { _id: 1, data: { $slice: 20 } } }\n    ).fetch();\n    p.forEach(element => {\n      playlists.push(Meteor.call(\"return_playlist_short\", element._id));\n    });\n    return playlists;\n  },\n  add_track_to_playlist(track, playlist) {\n    check(track, String);\n    check(playlist, String);\n    var tr = {\n      _id: track,\n      added_at: new Date()\n    };\n    if (tr) {\n      var pl = Playlists.findOne(playlist, { fields: { author_userId: 1 } });\n      if (pl.author_userId == this.userId) {\n        Playlists.update(playlist, { $push: { data: tr } });\n        return\n      } else {\n      }\n    } else {\n      throw new Meteor.Error(\"track not found\");\n    }\n  },\n  remove_from_playlist(track, playlist) {\n    check(track, String);\n    check(playlist, Match.ObjectIncluding({ _id: String }));\n    if (playlist.author_userId == this.userId) {\n      Playlists.update(\n        { _id: playlist._id },\n        { $pull: { data: { _id: track } } }\n        , function (err, res) {\n          throw new Meteor.Error(err)\n        });\n\n    }\n  },\n  returnAlbumName(id) {\n    check(id, String);\n    return Albums.findOne(id, { fields: { name: 1 } });\n  },\n  get_user_fullName(id) {\n    check(id, String);\n    var po = Meteor.users.findOne(id).tnid;\n    user = People_1.findOne(po);\n    return user.firstName + \" \" + user.lastName;\n  },\n  artist_short_info(artist) {\n    let og = Artists.findOne(\n      { _id: artist },\n      { fields: { stage_name: 1, 'profile.image': 1 } }\n    );\n    if (og) {\n      og.type = \"artist\";\n      og.href = og.type + \"/\" + og._id;\n\n      return og;\n\n    } else {\n      throw new Meteor.Error(\"some-rror\");\n    }\n  },\n  add_to_library(tr) {\n    check(tr, String);\n    var libItem = {};\n    if (this.userId) {\n      let tra = Meteor.call(\"get_full_track\", tr);\n      delete tra.track_number;\n      delete tra.plays;\n      libItem.item = tra;\n      libItem.added_at = new Date();\n      Meteor.users.update(\n        { _id: this.userId, \"library.item._id\": { $ne: tr } },\n        { $push: { library: libItem } }\n      );\n    } else {\n      throw new Meteor.Error(\"noUserId\");\n    }\n  },\n  add_artist_to_library(tr) {\n    check(tr, String);\n    var libItem = {};\n    if (this.userId) {\n      let tra = Meteor.call(\"artist_short_info\", tr);\n      libItem.item = tra;\n      libItem.added_at = new Date();\n      Meteor.users.update(\n        { _id: this.userId, \"library.item._id\": { $ne: tr } },\n        { $push: { library: libItem } }\n      );\n    } else {\n      throw new Meteor.Error(\"noUserId\");\n    }\n  },\n  delete_user_track(id) {\n\n    check(id, String);\n    if (!this.userId) {\n      return;\n    }\n\n\n\n\n    // UserTracks.remove({ _id: id, uploaded_by: this.userId });\n  },\n\n  async library_recently_added() {\n    if (this.userId) {\n      userId = this.userId;\n      var pipeline = [\n        { $match: { _id: userId } },\n        { $unwind: \"$library\" },\n        { $match: { \"library.item.type\": \"track\" } },\n        {\n          /*  $group: {\n              _id: '$library.item.album.name',\n              name: { $first: \"$library.item.album.name\" },\n              data: { $push: \"$library.item\" },\n              added_at: { $last: \"$library.added_at\" },\n              album: { $first: \"$library.item.album\" },\n  \n            }\n            */\n          $group: {\n            _id: {\n              id: '$library.item.album._id',\n              name: \"$library.item.album.name\"\n            },\n            data: { $push: \"$library.item\" },\n            added_at: { $last: \"$library.added_at\" },\n            album: { $first: \"$library.item.album\" },\n          }\n        },\n        { $project: { data: true, _id: 0, added_at: 1, album: 1, name: 1 } },\n        { $sort: { added_at: -1 } }\n      ];\n      return await Meteor.users\n        .rawCollection()\n        .aggregate(pipeline)\n        .toArray();\n    }\n  },\n\n  async get_album_tracks(album, filter) {\n    check(album, String)\n    var results = [];\n    var tracks = Tracks.find(\n      { album: album },\n      { fields: { _id: 1 } }\n    ).fetch();\n    tracks.forEach((e, i) => {\n\n      results.push(Meteor.call(\"get_full_track\", e._id));\n    });\n    return results;\n  },\n\n  async library_songs() {\n    if (this.userId) {\n      userId = this.userId;\n      var pipeline = [\n        { $match: { _id: userId } },\n        { $unwind: \"$library\" },\n        { $match: { \"library.item.type\": \"track\" } },\n        {\n          $group: {\n            _id: \"$library.item._id\",\n            track: { $first: \"$library.item\" },\n            added_at: { $last: \"$library.added_at\" }\n          }\n        },\n        { $project: { track: 1, _id: 0, added_at: 1 } },\n        { $sort: { \"track.title\": 1 } }\n      ];\n      return await Meteor.users\n        .rawCollection()\n        .aggregate(pipeline)\n        .toArray();\n    }\n  },\n  async library_albums() {\n    if (this.userId) {\n      userId = this.userId;\n      var pipeline = [\n        { $match: { _id: userId } },\n        { $unwind: \"$library\" },\n        { $match: { \"library.item.type\": \"track\" } },\n        {\n          $group: {\n            data: { $push: \"$library.item\" },\n            _id: \"$library.item.album._id\",\n            added_at: { $last: \"$library.added_at\" },\n            album: { $first: \"$library.item.album\" }\n          }\n        },\n        { $project: { data: true, _id: 0, added_at: 1, album: 1 } },\n        { $sort: { \"album.artists.stage_name\": 1 } }\n      ];\n      return await Meteor.users\n        .rawCollection()\n        .aggregate(pipeline)\n        .toArray();\n    }\n  },\n  async return_album(id) {\n    check(id, String);\n    var album = Albums.findOne(\n      { _id: id },\n      {\n        fields: {\n          release_date: 1,\n          artists: 1,\n          name: 1,\n          album_art: 1,\n          genres: 1,\n          album_type: 1,\n        }\n      }\n    );\n    if (!album) {\n      return\n    }\n    album.artists = await Promise.all(\n      album.artists.map(async artist => {\n        let og = Artists.findOne(\n          { _id: artist },\n          { fields: { stage_name: 1 } }\n        );\n        og.type = \"artist\";\n        og.href = og.type + \"/\" + og._id;\n        return og;\n      })\n    );\n    album.images = [];\n    for (let i = 0; i < 3; i++) {\n      var want = [64, 300, 640];\n      album.images.push({\n        height: String(want[i]),\n        width: String(want[i]),\n        url: cloudinary.url(album.album_art.id, {\n          width: want[i],\n          crop: \"fit\",\n          secure: true\n        })\n      });\n    }\n    // album.release_year = moment(album.release_date).format(\"YYYY\");\n    album.type = \"album\";\n    album.id = album._id\n\n    // delete album._id\n    delete album.album_art;\n\n    return album;\n  },\n  async return_album_info(id) {\n    check(id, String);\n    var album = Albums.findOne(\n      { _id: id },\n      {\n        fields: {\n\n          artists: 1,\n          name: 1,\n          genres: 1,\n\n        }\n      }\n    );\n    if (!album) {\n      return\n    }\n    album.artists = await Promise.all(\n      album.artists.map(async artist => {\n        let og = Artists.findOne(\n          { _id: artist },\n          { fields: { stage_name: 1 } }\n        );\n        og.type = \"artist\";\n\n        return og;\n      })\n    );\n    album.type = \"album\";\n    album.id = album._id\n\n    return album\n  },\n  get_albums(ids) {\n    check(ids, Array);\n\n    var albums = Albums.find(\n      { _id: { $in: ids } },\n      {\n        fields: {\n          release_date: 1,\n          artists: 1,\n          name: 1,\n          album_art: 1,\n          genres: 1,\n          album_type: 1,\n          description: 1\n        }\n      }\n    ).fetch();\n    if (albums.length) {\n\n      albums.forEach((album, index) => {\n        album.artists = album.artists.map(artist => {\n\n          let og = Artists.findOne(\n            { _id: artist },\n            { fields: { stage_name: 1 } }\n          );\n          og.type = \"artist\";\n          og.href = og.type + \"/\" + og._id;\n          return og;\n        });\n\n        album.images = formatImage(album.album_art.id, [64, 300, 640]);\n        album.release_year = moment(album.release_date).format(\"YYYY\");\n        album.type = \"album\";\n        album.id = album._id;\n        delete album.album_art;\n      });\n\n    }\n    return albums;\n\n  },\n  return_images(id) {\n    let images = [];\n    for (let i = 0; i < 3; i++) {\n      var want = [64, 300, 640];\n      images.push({\n        height: String(want[i]),\n        width: String(want[i]),\n        url: cloudinary.url(id, { width: want[i], crop: \"fit\", secure: true })\n      });\n    }\n    return images;\n  },\n  async return_album_full(id) {\n    let album = Albums.findOne(\n      { _id: id },\n      {\n        fields: {\n          release_date: 1,\n          artists: 1,\n          name: 1,\n          album_art: 1,\n          genres: 1,\n          description: 1,\n          album_type: 1\n        }\n      }\n    );\n    if (!album) {\n      throw new Meteor.Error(\"no-album\");\n    }\n    album.artists = await Promise.all(\n      album.artists.map(async artist => {\n        let og = Artists.findOne(\n          { _id: artist },\n          { fields: { stage_name: 1 } }\n        );\n        og.type = \"artist\";\n        og.href = og.type + \"/\" + og._id;\n        return og;\n      })\n    );\n    album.tracks = Tracks.find(\n      { album: album._id },\n      {\n        fields: {\n          album: 1,\n          explicit: 1,\n          featuring_artists: 1,\n          genres: 1,\n          title: 1,\n          track_number: 1,\n          type: 1,\n          formats: 1,\n          duration: 1\n        },\n        sort: { track_number: 1 }\n      }\n    ).fetch();\n    album.tracks.forEach((el, index) => {\n      if (el.featuring_artists.length)\n        el.featuring_artists.forEach((e, i) => {\n          let v = Meteor.call(\"artist_short_info\", e);\n          el.featuring_artists[i] = v;\n        });\n    });\n    album.images = [];\n    for (let i = 0; i < 3; i++) {\n      var want = [64, 300, 640];\n      album.images.push({\n        height: String(want[i]),\n        width: String(want[i]),\n        url: cloudinary.url(album.album_art.id, {\n          width: want[i],\n          crop: \"fit\",\n          secure: true\n        })\n      });\n    }\n    album.type = \"album\";\n    album.release_year = moment(album.release_date).format(\"YYYY\");\n    album.id = album._id;\n    album.href = album.type + \"/\" + album.id;\n    delete album.album_art;\n    return album;\n  },\n  async add_you_to_library(tra) {\n    check(tra, {\n      id: String,\n      imgurl: String,\n      title: NonEmptyString\n    });\n    var url = \"https://www.youtube.com/watch?v=\" + tra.id;\n    var userId = this.userId;\n    var notexists = Meteor.users.find({\n      _id: userId,\n      \"library.item._id\": { $ne: tra.id }\n    });\n    if (!notexists) {\n      throw new Meteor.Error(\"track-exists\");\n    }\n    check(url, String);\n    var stream = cloudinary.v2.uploader.upload_stream(\n      { resource_type: \"auto\" },\n      Meteor.bindEnvironment(function (error, result) {\n        if (!error) {\n          var item = {\n            _id: tra.id,\n            added_at: new Date(),\n            item: {\n              //       :result.secure_url,\n              album: {\n                _id: \"youtube\",\n                name: \"Youtube\",\n                images: [{ url: tra.imgurl }, { url: tra.imgurl }],\n                artists: [{ id: \"youtube\", stage_name: \"Youtube\" }]\n              },\n              _id: tra.id,\n              title: tra.title,\n              type: \"track\",\n              duration: result.duration,\n              featuring_artists: []\n            }\n          };\n          item.item[result.format] = result.secure_url;\n\n          Youtube.insert(item);\n          Meteor.users.update(\n            { _id: userId, \"library.item._id\": { $ne: item.item._id } },\n            { $push: { library: item } }\n          );\n\n          return true;\n        }\n      })\n    );\n    var yout = Youtube.findOne(tra.id);\n    if (yout) {\n      //$ne not needed , just in case.\n\n      yout.added_at = new Date();\n      Meteor.users.update(\n        { _id: userId, \"library.item._id\": { $ne: yout } },\n        { $push: { library: yout } }\n      );\n\n      return true;\n    } else {\n      ytdl(url, {\n        filter: \"audioonly\"\n      }).pipe(stream);\n    }\n  },\n  get_artist(id) {\n    check(id, String);\n    let art = Artists.findOne(id);\n\n    art.href = \"artist\" + \"/\" + art._id;\n    art.profile.genres.forEach((e, i) => {\n      art.profile.genres[i] = Genres.findOne(e) ? Genres.findOne(e).name : \"Unknown Genre\";\n    });\n    return art;\n  },\n  get_artists(artists) {\n    check(artists, Array);\n    let art = Artists.find(\n      { _id: { $in: artists } },\n\n    ).fetch();\n\n    return art;\n  },\n  async get_artist_lr(artist) {\n    check(artist, String);\n    let alb = Albums.findOne(\n      { artists: { $in: [artist] } },\n      { sort: { release_date: -1 }, fields: { _id: 1 } }\n    );\n    if (alb) {\n      return Meteor.call(\"return_album\", alb._id);\n    }\n  },\n  async get_artist_topsongs(artist, lim, search) {\n    check(artist, String);\n    let albums = Albums.find(\n      { artists: { $in: [artist] } },\n      { fields: { _id: 1 } }\n    ).fetch();\n    let albumTracks = await Promise.all(\n      albums.map(async album => {\n        let tr = Tracks.find(\n          { album: album._id },\n          { fields: { _id: 1 }, sort: { plays: -1 }, limit: lim || 50 }\n        ).fetch();\n        return tr;\n      })\n    );\n    var artistTracks = [].concat.apply([], albumTracks);\n    var arr2 = Tracks.find(\n      { featuring_artists: { $in: [artist] } },\n      { fields: { _id: 1 }, sort: { plays: -1 }, limit: lim || 50 }\n    ).fetch();\n    var toRe = artistTracks.concat(arr2).sort((a, b) => {\n      if (a.plays && b.plays) {\n        return b.plays - a.plays;\n      } else {\n        return -5;\n      }\n    });\n    var mapo = toRe.map(x => Meteor.call(\"get_full_track\", x._id));\n    if (search) {\n      return mapo;\n    }\n    var playlist = {\n      data: mapo,\n      name: \"Top songs\",\n      _id: artist\n    };\n    //If not Show all page\n    if (!lim) {\n      let name = Meteor.call(\"artist_short_info\", artist);\n      name.stage_name;\n      playlist.name += \" - \" + name.stage_name;\n    }\n    return playlist;\n  },\n  async get_artist_albums(artist) {\n    check(artist, String);\n    let albs = Albums.find(\n      { artists: { $in: [artist] } },\n      { fields: { _id: 1 }, sort: { release_date: -1 } }\n    ).fetch();\n    var albums = albs.map(x => Meteor.call(\"return_album\", x._id));\n    return albums;\n  },\n  async get_artist_sm(id, genre) {\n    check(id, String);\n    check(id, String);\n    var toReturn = [];\n    let artists = Artists.find(\n      { _id: { $ne: id }, 'profile.genres': { $all: genre } },\n      {\n        fields: {\n          _id: 1,\n          image: 1,\n          cover: 1,\n          type: 1,\n          genres: 1,\n          bio: 1,\n          stage_name: 1,\n          notes: 1\n        },\n        limit: 10\n      }\n    ).fetch();\n    artists.forEach((art, ind) => {\n      art.href = \"artist\" + \"/\" + art._id;\n      art.id = art._id;\n      art.type = \"artist\";\n      art.genres.forEach((e, i) => {\n        art.genres[i] = Genres.findOne(e).name;\n      });\n      toReturn.push(art);\n    });\n    return toReturn;\n  },\n  remove_from_library(id) {\n    check(id, String);\n\n    if (!this.userId) {\n      throw new Meteor.user(\"nouser\");\n    }\n    Meteor.users.update(\n      { _id: this.userId },\n      { $pull: { library: { \"item._id\": id } } }\n    );\n\n\n    Meteor.users.update({ _id: this.userId }, {\n      $pull: {\n        'recently_played': { 'item._id': id }\n      }\n    })\n\n\n  },\n  like_item(item) {\n    //Need Update\n    check(item, String);\n    if (this.userId) {\n      Meteor.users.update({ _id: this.userId }, { $push: { likes: item } });\n    }\n  },\n  dislike_item(item) {\n    check(item, String);\n    if (this.userId) {\n      Meteor.users.update({ _id: this.userId }, { $pull: { likes: item } });\n    }\n  },\n  add_artist(artist) {\n    if (this.userId) {\n      // let art = Meteor.call(\"artist_short_info\", artist);\n      // art.artist = artist;\n\n      //Purposely did't check if the user is already following because should'nt happen\n      //Only if some called the code manually \n      Artists.update({ _id: artist }, { $push: { followers: this.userId } })\n      Meteor.users.update(\n        {\n          _id: this.userId,\n          \"artists\": { $nin: [artist] }\n        }, { $push: { artists: artist } }\n      );\n    }\n\n  }, remove_artist(artist) {\n    check(artist, String)\n    if (this.userId) {\n      Meteor.users.update(\n        {\n          _id: this.userId,\n\n        }, { $pull: { artists: artist } }\n      );\n    }\n    Artists.update({ _id: artist }, { $pull: { followers: this.userId } })\n\n\n\n  },\n  async more_by_artists(artists, album) {\n    check(artists, [Match.ObjectIncluding({ _id: String })]);\n    check(album, String);\n    var albums = [];\n\n    art = artists.map(el => {\n      return el._id;\n    });\n    let albs = Albums.find(\n      { _id: { $ne: album }, artists: { $in: art } },\n      { fields: { _id: 1 }, sort: { release_date: -1 } }\n    ).fetch();\n\n    albs.forEach(el => {\n      albums.push(Meteor.call(\"return_album\", el._id));\n    });\n    return albums;\n  },\n  add_user_track(track) {\n    //To Library\n\n    check(\n      track,\n      Match.ObjectIncluding({\n        original: String,\n        title: String,\n        artist: String,\n        duration: Match.Integer\n      })\n    );\n    if (this.userId) {\n      var obj = track;\n      obj.formats = [\n        {\n          url: track.original,\n          format: track.format\n        }\n      ];\n\n      obj.album = {\n        name: obj.album || \"Unknown Album\",\n        images: obj.image_url ? formatImage(obj.image_url, [64, 300, 640]) : [],\n        type: \"album\",\n        _id: obj.album.length ? obj.album.replace(/\\W/g, '').toLowerCase() : 'unknown',\n        id: obj.album.length ? obj.album.replace(/\\W/g, '').toLowerCase() : 'unknown',\n        artists: [{ stage_name: obj.artist || \"Unknown Artist\", _id: obj.artist ? obj.artist.replace(/\\W/g, '').toLowerCase() : 'unknown' }],\n        user_album: true\n      };\n\n\n      obj.featuring_artists = []\n      delete obj.original;\n\n      obj.user_track = true;\n      delete obj.image_url;\n      obj.type = \"track\";\n      obj._id = Random.id(10)\n      var libItem = {\n        item: obj,\n        added_at: new Date()\n      }\n      try {\n\n        Meteor.users.update({ _id: this.userId }, {\n          $push: {\n            library: {\n              $each: [libItem]\n              , $position: 0\n            }\n          }\n        })\n        obj.uploaded_by = this.userId;\n        obj.uploaded_at = new Date();\n        UserTracks.insert(obj)\n\n      } catch (err) {\n        console.log(err)\n      }\n\n    }\n  }, add_to_user_library(item) {\n\n  }\n});\n/*\nTracks.insert({ \"_id\": Random.id(), \"explicit\": false, \"featuring_artists\": [], \"genres\": [\"\"], \"title\": \"Trap Trap Trap\", \"recording_year\": 2019, \"version\": \"original\", \"album\": \"FdNAsQjrHXmEAGDvL\", \"language_code\": \"en\", \"added_at\": \"2020-01-07T17:53:32.198Z\", \"plays\": 0, \"formats\": [{ \"format\": \"wav\", \"url\": \"https://res.cloudinary.com/neighborhood/video/upload/v1578413538/releases/JMA8PbxBrI.wav\", \"id\": \"releases/JMA8PbxBrI\" }], \"duration\": 193.828571 }, function (err, info) {\n\n})\n*/","export const Albums = new Mongo.Collection(\"albums\");\nexport const Markets = new Mongo.Collection(\"markets\");\nexport const Tracks = new Mongo.Collection(\"tracks\");\nexport const Genres = new Mongo.Collection(\"genres\");\nexport const Discover = new Mongo.Collection(\"discover\");\nexport const Playlists = new Mongo.Collection(\"playlists\");\nexport const Activities = new Mongo.Collection(\"activities\");\nexport const Artists = new Mongo.Collection(\"artists\");\nexport const Youtube = new Mongo.Collection(\"youtube\");\nexport const UserTracks = new Mongo.Collection(\"usertracks\");\nexport const Releases = new Mongo.Collection(\"releases\");\nexport const Spaces = new Mongo.Collection('spaces')\n","import {\n  Tracks,\n  Discover,\n  Albums,\n  Playlists,\n  Genres,\n  Artists,\n  Activities,\n  UserTracks,\n  Releases\n} from \"./collections\";\n\nimport { ReactiveAggregate } from \"meteor/tunguska:reactive-aggregate\";\nimport { People_1 } from \"../startup/server/register-api\";\n\nMeteor.publish(\"userInfo\", function () {\n  var sub = this;\n  var observeHandle = Meteor.users.find(this.userId).observeChanges({\n    added: function (id, fields) {\n      delete fields.artists\n\n      sub.added('users', id, fields);\n    },\n    changed: function (id, fields) {\n\n      sub.changed('users', id, fields);\n    },\n    removed: function (id) {\n      sub.removed('users', id);\n    }\n  });\n\n});\nMeteor.publish('myartists', function () {\n  var sub = this;\n  if (this.userId) {\n\n    var observeHandle = Meteor.users.find(this.userId, { fields: { artists: 1 } }).observeChanges({\n      added: function (id, fields) {\n        if (fields.artists && fields.artists.length) {\n          var toreturn = fields.artists.map((el) => {\n            return Meteor.call('artist_short_info', el)\n\n\n          })\n          sub.added('users', id, { artists: toreturn });\n        }\n      },\n      changed: function (id, fields) {\n        var toreturn = fields.artists.map((el) => {\n          return Meteor.call('artist_short_info', el)\n        })\n\n        sub.changed('users', id, { artists: toreturn });\n      },\n\n    });\n  }\n\n})\n\nMeteor.publish(\"SSOInfo\", function () {\n  if (this.userId)\n    var userId = Meteor.users.findOne(this.userId, { fields: { tnid: 1 } }).tnid\n\n  return People_1.find({ _id: userId }, {\n    fields: {\n      firstName: 1, lastName: 1, emails: 1, email: 1, birthday: 1, avatar: 1\n    }\n  })\n})\n\nMeteor.publish(\"artist\", function (id) {\n  check(id, String);\n  let art = Meteor.call('get_artist', id)\n  //console.log(art)\n  if (art) {\n    art.href = art.type + \"/\" + art._id;\n    art.id = art._id;\n    art.sm = Meteor.call(\"get_artist_sm\", id, art.profile.genres);\n\n    art.al = Meteor.call(\"get_artist_albums\", id);\n    art.ts = Meteor.call(\"get_artist_topsongs\", id, 24);\n    art.lr = Meteor.call(\"get_artist_lr\", id);\n\n    this.added(\"artists\", art._id, art);\n    this.ready();\n  }\n});\n\nMeteor.publish(\"discover_nr\", function (num) {\n  check(num, Match.Integer);\n  var region = \"UA\";\n\n  return Discover.find(\n    {\n      market: region,\n      name: \"newreleases\"\n    },\n    { fields: { _id: 1, name: 1, market: 1, data: { $slice: num } } }\n  );\n});\nMeteor.publish(\"discover_featured\", function () {\n  var region = \"UA\";\n  return Discover.find({\n    market: region,\n    name: \"featured\"\n  });\n});\nMeteor.publish(\"discover_playlist\", function () {\n  var region = \"UA\";\n  check(region, String);\n  var playlists = Playlists.findOne(\n    { _id: \"hottracksua\", market: region, verified: true },\n    { fields: { _id: 1 } });\n\n  if (playlists && playlists._id) {\n\n\n    var playlist = Meteor.call(\"returnPlaylist\", playlists._id);\n\n    this.added(\"playlists\", playlist._id, playlist);\n  }\n  this.ready();\n\n});\nMeteor.publish(\"pub_playlists\", function (limit) {\n  var region = \"UA\";\n  check(region, String);\n  var playlists = Playlists.find(\n    { _id: { $ne: \"hottracksua\" }, market: region },\n    { fields: { _id: 1 }, limit: limit ? limit : 30 }\n  )\n  //console.log(playlists)\n  // if (playlists.length) {\n  playlists.forEach(async e => {\n    if (e._id) {\n      var playlist = await Meteor.call(\"return_playlist_short\", e._id);\n    }\n    this.added(\"playlists\", playlist._id, playlist);\n  });\n  this.ready();\n  //  }\n});\nMeteor.publish(\"album\", function (id) {\n  var album = Meteor.call(\"return_album_full\", id);\n  this.added(\"albums\", album.id, album);\n  this.ready();\n});\n\n//This playlist needs to be tested\n\nMeteor.publish(\"playlist\", function (id) {\n  check(id, String);\n  var sub = this;\n  var playlist = Meteor.call(\"returnPlaylist\", id);\n  var subHandle = Playlists.find({ _id: id }).observeChanges({\n    changed: (id, fields) => {\n      var playlist = Meteor.call(\"returnPlaylist\", id);\n      sub.changed('playlists', id, playlist);\n\n    },\n    removed: id => {\n      this.removed(\"playlists\", id);\n    }\n  });\n  // if (playlist.author_userId == this.userId || playlist.public == true) {\n\n  this.added(\"playlists\", playlist._id, playlist);\n  this.ready();\n  // }\n});\n\nMeteor.publish(\"userPlaylists\", function () {\n  return Playlists.find(\n    { author_userId: this.userId },\n    { fields: { _id: 1, href: 1, name: 1, author_userId: 1, type: 1 } }\n  );\n});\nMeteor.publish(\"genres\", function () {\n  return Genres.find();\n});\n\nMeteor.publish(\"new_releases\", function (limit) {\n  let albums = Albums.find(\n    {\n      album_type: { $ne: \"single\" },\n      added_at: {\n        $gte: new Date(new Date().getTime() - 24 * 14 * 60 * 60 * 1000)\n      }\n    },\n    { fields: { _id: 1 }, limit: limit ? limit : 12, sort: { added_at: -1 } }\n  ).fetch();\n  albums.forEach((e, i) => {\n    let album = Meteor.call(\"return_album\", e._id);\n    this.added(\"albums\", e._id, album);\n  });\n  this.ready();\n});\nMeteor.publish(\"new_tracks\", function (lim) {\n  // added_at: { $gte: new Date(new Date().getTime() - 24 * 28 * 60 * 60 * 1000) } \n  let singles = Albums.find(\n    { album_type: \"single\", },\n    { limit: lim ? lim : 16, fields: { _id: 1 }, sort: { added_at: -1 } }\n  ).fetch();\n  singles.forEach((e, i) => {\n    var ft = Meteor.call(\"get_album_tracks\", e._id);\n    ft.forEach(el => {\n\n      this.added(\"tracks\", el._id, el);\n    });\n  });\n  this.ready();\n});\nMeteor.publish(\"account\", function () {\n  if (this.userId) {\n    var po = Meteor.users.findOne(this.userId).tnid;\n    var user = People_1.findOne(po, {\n      fields: {\n        _id: 1,\n        avatar: 1,\n        firstName: 1,\n        lastName: 1,\n        birthday: 1,\n        email: 1,\n        emails: 1\n      }\n    });\n    this.added(\"users\", this.userId, user);\n    this.ready();\n  }\n});\nMeteor.publish(\"trending\", function () {\n  self = this;\n  var pl = {\n    _id: \"toptracksua\",\n    data: [],\n    name: \"Trending Tracks\",\n    type: \"playlist\",\n    auto: true\n  };\n  var pipeline = [\n    {\n      $match: {\n        date: { $gte: new Date(new Date().getTime() - 24 * 7 * 60 * 60 * 1000) }\n      }\n    },\n    {\n      $group: {\n        _id: \"$item.id\",\n        date: { $last: \"$date\" },\n        totalPlays: { $sum: 1 }\n      }\n    },\n    { $sort: { date: -1, totalPlays: -1 } },\n    { $limit: 20 }\n  ];\n\n  Activities.rawCollection()\n    .aggregate(pipeline)\n    .toArray(\n      Meteor.bindEnvironment(function (err, sort) {\n        sort.forEach((el, ind) => {\n          var track = Meteor.call(\"get_full_track\", el._id);\n          if (track) {\n            track.position = ind + 1;\n\n            pl.data.push(track);\n          } else {\n            //   Activities.remove({ 'item.id': el._id })\n            //    console.log('DELETE ' + el._id)\n          }\n        });\n\n        self.added(\"playlists\", pl._id, pl);\n      })\n    );\n\n  var disco1 = {\n    _id: \"topplaylists\",\n    name: \"Top Playlists\",\n    data: [],\n\n    market: \"UA\",\n    auto: true\n  };\n  playlists = Playlists.find(\n    { _id: { $ne: \"hottracksua\" } },\n    { fields: { _id: 1 }, sort: { plays: -1 } }\n  ).fetch();\n  playlists.forEach((el, ind) => {\n    let playlist = Meteor.call(\"return_playlist_short\", el._id);\n    playlist.position = ind + 1;\n    disco1.data.push(playlist);\n  });\n\n  var pipeline = [\n    { $group: { _id: \"$album\", totalPlays: { $sum: \"$plays\" } } },\n    { $sort: { totalPlays: -1 } }\n  ];\n  Tracks.rawCollection()\n    .aggregate(pipeline)\n    .toArray(\n      Meteor.bindEnvironment(function (err, sort) {\n        sort.forEach((el, ind) => {\n          var album = Meteor.call(\"return_album\", el._id);\n\n          album.position = ind + 1;\n          if (album) {\n            self.added(\"albums\", album._id, album);\n          }\n        });\n      })\n    );\n\n  self.added(\"discover\", disco1._id, disco1);\n  self.ready();\n});\nMeteor.publish(\"library_songs\", function () {\n  userId = this.userId;\n  // Remember, ReactiveAggregate doesn't return anything\n  var pipeline = [\n    { $match: { _id: userId } },\n    { $unwind: \"$library\" },\n    { $match: { \"library.item.type\": \"track\" } },\n    {\n      $group: {\n        _id: \"$library.item._id\",\n        track: { $first: \"$library.item\" },\n        added_at: { $last: \"$library.added_at\" }\n      }\n    },\n    { $project: { track: 1, _id: 1, added_at: 1 } },\n    { $sort: { \"track.title\": 1 } }\n  ];\n\n  ReactiveAggregate(\n    this,\n    Meteor.users, // Send the aggregation to the 'clientReport' collection available for client use by using the clientCollection property of options.\n    pipeline,\n    { clientCollection: \"librarySongs\" }\n  );\n});\n\nMeteor.publish(\"myuploads\", function () {\n  return UserTracks.find({ uploaded_by: this.userId });\n});\n\n/**\n *\n * Server Functions are below\n *\n *\n */\n\nMeteor.publish(\"genre_albums\", function (_id) {\n  var self = this;\n  check(_id, String);\n\n  var albums = Albums.find(_id == \"all\" ? {} : { genres: { $in: [_id] } }, {\n    fields: { _id: 1 }\n  }).fetch();\n  var toReturn = Meteor.call(\n    \"get_albums\",\n    albums.map(el => el._id)\n  );\n  toReturn.forEach((el, ind) => {\n    self.added(\"albums\", el._id, el);\n  });\n\n  var observeHandle = Albums.find({}).observeChanges({\n    added: function (id, fields) {\n\n    },\n    changed: function (id, fields) {\n\n\n    },\n    removed: function (id) {\n      self.removed('albums', id);\n    }\n  });\n\n\n\n  self.ready();\n});\n\nMeteor.publish(\"myreleases\", function (space_id) {\n  return Releases.find(\n    { \"space.owner\": this.userId },\n    { fields: { tracks: 0 } }\n  );\n});\n\nMeteor.publish(\"release\", function (id) {\n  return Releases.find({ _id: id, \"space.owner\": this.userId });\n});\n\n\n\nRouter.route(\"/api/artists/:a\", {\n  where: \"server\"\n}).get(function () {\n  var self = this;\n  this.response.setHeader(\"Content-type\", \"application/json\");\n  this.response.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  let artists = Artists.find({\n    stage_name: {\n      $regex: new RegExp(self.params.a, \"i\")\n    }\n  }).fetch()\n\n  self.response.end(JSON.stringify(artists));\n\n\n});\n\n\nMeteor.publish(\"recently_played\", function () {\n  userId = this.userId;\n  // Remember, ReactiveAggregate doesn't return anything\n  var pipeline = [\n    { $match: { _id: userId } },\n    { $unwind: \"$recently_played\" },\n    {\n      $group: {\n        _id: \"$recently_played.item.album._id\",\n        album: { $last: \"$recently_played.item.album\" },\n        data: { $last: \"$recently_played.item\" },\n        date: { $last: \"$recently_played.date\" }\n      }\n    },\n    { $project: { album: 1, _id: 1, date: 1, data: 1 } },\n    { $sort: { \"date\": -1 } }\n  ];\n\n  ReactiveAggregate(\n    this,\n    Meteor.users, // Send the aggregation to the 'clientReport' collection available for client use by using the clientCollection property of options.\n    pipeline,\n    { clientCollection: \"recently_played\" }\n  );\n});","// Import modules used by both client and server through a single index entry point\n// e.g. useraccounts configuration file.\nimport  '/imports/api/collections.js';\nexport {Markets,Albums} from '/imports/api/collections.js';","// Fill the DB with example data on startup\n\nimport { Meteor } from 'meteor/meteor';\n\n","// Import server startup through a single index entry point\nimport '../../api/links/methods.js'\nimport '../../api/publications.js'\nimport './fixtures.js';\nimport './register-api.js';\nimport './searchIndexes.js'","\nexport const SharedTokens = new Mongo.Collection('sharedtokens')\n// Register your apis here\n\n\nconst accountsDomain = Meteor.settings.public.ourUrls ? Meteor.settings.public.ourUrls.accounts : \"http://localhost:3005\";\n\nconst NBAccounts = DDP.connect(accountsDomain);\nNBAccounts.subscribe('serverContent')\nexport const People_1 = new Mongo.Collection('users', {\n  connection: NBAccounts,\n  _suppressSameNameError: true,\n\n})\n\nAccounts.registerLoginHandler(\"sso2\", options => {\n  if (!options.it) {\n    return\n  }\n  var valid = NBAccounts.call('validateToken', options)\n\n  if (valid && valid.userId) {\n    var LT = {\n\n      userId: Meteor.users.findOne({ tnid: valid.userId })\n        ? Meteor.users.findOne({ tnid: valid.userId })._id\n        : Meteor.call(\"createAccount\", valid.userId)\n    }\n\n    return {\n      userId: LT.userId,\n\n    }\n  } else {\n\n    return {\n      //  userId: user._id,\n      error: new Meteor.Error(\n        403,\n        \"\"\n      )\n    };\n  }\n});\n\nAccounts.onLogin((attempt) => {\n  if (attempt.type == \"sso2\") {\n    var LT = {\n      timestamp: Date.now(),\n      gid: attempt.methodArguments[0].it.slice(40, 60),\n      userId: attempt.user._id,\n      token: Accounts._getLoginToken(attempt.connection.id)\n    }\n    SharedTokens.insert(LT)\n    return {\n      userId: LT.userId,\n    }\n  }\n})\nMeteor.methods({\n  'logoutUser'(user, gids) {\n    var user = Meteor.users.findOne({ tnid: user }, { fields: { id: 1 } })\n    var tokens = SharedTokens.find({ gid: { $in: gids } }, { fields: { token: 1 } }).fetch().map((el, index) => el.token)\n    Meteor.users.update(user._id, { $pull: { 'services.resume.loginTokens': { hashedToken: { $in: tokens } } } })\n  }\n})\n\nAccounts.validateLoginAttempt((user, connection) => {\n\n  return true\n})\n\nMeteor.default_server.method_handlers[\"logout\"] = function () {\n\n  let accounts = Accounts;\n  let user = this.userId;\n  let conn = this.connection;\n  var token = Accounts._getLoginToken(this.connection.id);\n  accounts._setLoginToken(this.userId, this.connection, null);\n  if (token && this.userId) accounts.destroyToken(this.userId, token);\n  accounts._successfulLogout(this.connection, this.userId);\n  this.setUserId(null);\n\n  var tokens = SharedTokens.find({ token: token }, { fields: { gid: 1, _id: 0 } }).fetch()\n  SharedTokens.update({ token: token }, { $set: { status: 'inactive' } })\n\n  var gids = tokens.map(function ({ gid }, index) {\n    return gid;\n  });\n\n  var id = Meteor.users.findOne(user, { fields: { tnid: 1 } }).tnid\n  NBAccounts.call('logoutUser', id, gids, conn)\n\n\n}","import { Tracks, Albums, Artists, Playlists } from \"../../api/collections.js\";\n//Tracks._dropIndex(\"name_text\");\nimport \"../../api/links/methods.js\";\nimport { check } from \"meteor/check\";\n\nvar elasticsearch = Npm.require(\"elasticsearch\");\nvar client = new elasticsearch.Client({\n  host: Meteor.settings.elasticserver ? Meteor.settings.elasticserver.url : \"http://192.168.31.50:9200\"\n  // log: 'trace'\n});\n\nfunction getUnique(arr, comp) {\n  const unique = arr\n    .map(e => e[comp])\n\n    // store the keys of the unique objects\n    .map((e, i, final) => final.indexOf(e) === i && i)\n\n    // eliminate the dead keys & store unique objects\n    .filter(e => arr[e])\n    .map(e => arr[e]);\n\n  return unique;\n}\n\nMeteor.methods({\n  async search_songs(que) {\n    var searchText = que;\n\n    //  return;\n\n    if (!que.length) {\n      return [];\n    }\n    let lastWord = searchText\n      .trim()\n      .split(\" \")\n      .splice(-1)[0];\n\n    let query = {\n      bool: {\n        must: {\n          dis_max: {\n            queries: [\n              {\n                match_phrase: {\n                  title: { query: searchText, slop: 3 }\n                }\n              },\n              { match: { title: { query: searchText, boost: 1.25 } } },\n              { prefix: { title: searchText } },\n              {\n                nested: {\n                  path: \"artists\",\n\n                  query: {\n                    match: {\n                      \"artists.stage_name\": { query: searchText, boost: 1.5 }\n                    }\n                  }\n                }\n              },\n              {\n                nested: {\n                  path: \"artists\",\n                  query: {\n                    prefix: {\n                      \"artists.stage_name\": searchText\n                    }\n                  }\n                }\n              },\n              {\n                nested: {\n                  path: \"featuring_artists\",\n                  query: {\n                    match: {\n                      \"featuring_artists.stage_name\": {\n                        query: searchText,\n                        boost: 1.25\n                      }\n                    }\n                  }\n                }\n              },\n              {\n                nested: {\n                  path: \"featuring_artists\",\n                  query: {\n                    prefix: {\n                      \"featuring_artists.stage_name\": searchText\n                    }\n                  }\n                }\n              },\n              { match: { album: { query: searchText, boost: 1.3 } } },\n              { prefix: { album: searchText } }\n            ]\n          }\n        },\n        // boost: 1,\n        filter: {\n          term: {\n            type: \"track\"\n          }\n        }\n      }\n    };\n\n    let results = [];\n\n    var result = await client.search({\n      index: \"database1\",\n      body: { query: query }\n    });\n\n    result.hits.hits.forEach(function (doc) {\n      if (doc._source.type == \"track\") {\n        try {\n          var ta = Meteor.call(\"get_full_track\", doc._id)\n          if (ta._id) {\n            results.push(ta);\n          }\n        } catch (err) {\n        }\n      }\n    });\n    return results;\n  },\n\n  async search_albums(sear) {\n    check(sear, String);\n    if (!sear.length) {\n      return [];\n    }\n    var searchText = sear;\n    var lastWord = sear\n      .trim()\n      .split(\" \")\n      .splice(-1)[0];\n    let query = {\n      bool: {\n        filter: {\n          term: {\n            type: \"album\"\n          }\n        },\n        must: [\n          {\n            bool: {\n              should: [\n                { match: { name: { query: searchText, boost: 1.25 } } },\n                { prefix: { name: searchText } },\n\n                {\n                  nested: {\n                    path: \"artists\",\n                    query: {\n                      match_phrase: {\n                        \"artists.stage_name\": searchText\n                      }\n                    }\n                  }\n                },\n                {\n                  nested: {\n                    path: \"artists\",\n                    query: {\n                      match_phrase_prefix: {\n                        \"artists.stage_name\": searchText\n                      }\n                    }\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    };\n\n    var result = await client.search({\n      index: \"database1\",\n      body: { query: query }\n    });\n\n    var wow = result.hits.hits.map(function ({ _id, ...nonsense }, index) {\n      return _id;\n    });\n\n    let results = await Meteor.call(\"get_albums\", wow);\n    return results;\n  },\n  async search_artists(sear) {\n    check(sear, String);\n    if (!sear.length && sear.length <= 2) {\n      return [];\n    }\n    var searchText = sear;\n    var lastWord = sear\n      .trim()\n      .split(\" \")\n      .splice(-1)[0];\n    var query = {\n      bool: {\n        must: [\n          {\n            bool: {\n              should: [\n                { match: { stage_name: searchText } },\n                { prefix: { stage_name: lastWord } }\n              ]\n            }\n          }\n        ],\n\n        filter: {\n          match: {\n            type: \"artist\"\n          }\n        }\n      }\n    };\n\n    let results = [];\n\n    var result = await client.search({\n      index: \"database1\",\n      body: { query: query }\n    });\n    var wow = result.hits.hits.map(function ({ _id, ...nonsense }, index) {\n\n      return _id;\n    });\n    return Meteor.call(\"get_artists\", wow);\n  },\n  search_playlists(sear) {\n    if (!sear.length) {\n      return [];\n    }\n    var results = [];\n    var playlists = Playlists.find(\n      {\n        $text: { $search: sear },\n        verified: true,\n        public: true,\n        _id: { $ne: \"hottracksua\" }\n      },\n      { fields: { _id: 1 } }\n    ).fetch();\n    playlists.forEach((e, i) => {\n      results.push(Meteor.call(\"returnPlaylist\", e._id));\n    });\n    return results;\n  }\n});\n","const USER = {\n    _id: \"\",\n}\n","import { Artists, Albums, Tracks } from \"../imports/api/collections\";\n\nvar elasticsearch = Npm.require(\"elasticsearch\");\nvar client = new elasticsearch.Client({\n  host: \"192.168.31.50:9200\"\n  // log: 'trace'\n});\nasync function putMapping() {\n  console.log(\"Creating Mapping index\");\n  client.indices.create(\n    {\n      index: \"database1\",\n      body: {\n        mappings: {\n          properties: {\n            stage_name: {\n              type: \"text\",\n              fields: {\n                keyword: { type: \"keyword\" }\n              }\n            },\n            genres: {\n              type: \"keyword\",\n              fields: {\n                text: {\n                  type: \"text\"\n                }\n              }\n            },\n            created_on: { type: \"date\" },\n            type: { type: \"keyword\" },\n            name: {\n              type: \"text\",\n              fields: {\n                keyword: {\n                  type: \"keyword\"\n                }\n              }\n            },\n            featuring_artists: {\n              type: \"nested\",\n              include_in_parent: true,\n              properties: {\n                _id: { type: \"keyword\" },\n                stage_name: {\n                  type: \"text\",\n                  fields: {\n                    keyword: {\n                      type: \"keyword\"\n                    }\n                  }\n                }\n              }\n            },\n            artists: {\n              include_in_parent: true,\n              type: \"nested\",\n              properties: {\n                _id: { type: \"keyword\" },\n                stage_name: {\n                  type: \"text\",\n                  fields: {\n                    keyword: {\n                      type: \"keyword\"\n                    }\n                  }\n                }\n              }\n            },\n\n            title: {\n              type: \"text\",\n              fields: {\n                keyword: {\n                  type: \"keyword\"\n                }\n              }\n            },\n            album: {\n              type: \"text\",\n              fields: {\n                keyword: {\n                  type: \"keyword\"\n                }\n              }\n            },\n            album_id: { type: \"keyword\" }\n          }\n        }\n      }\n    },\n    (err, resp, status) => {\n      if (err) {\n        console.error(err, status);\n      } else {\n        console.log(\"Successfully Created Index\", status, resp);\n      }\n    }\n  );\n}\n/*\nclient.indices.putMapping({\n  index: \"database\",\n  body: {\n    properties: {\n      name: {\n        type: \"text\",\n        fields: {\n          keyword: {\n            type: \"text\"\n          }\n        }\n      }\n    }\n  }\n});\n\n*/\n\n//putMapping();\n/*client.reindex({\n  body: {\n    conflicts: \"proceed\",\n    source: { index: \"nelisten\" },\n    dest: { index: \"listen2\" }\n  }\n});\n*/\nvar FIELDS_TO_INCLUDE = [\"_id\", \"stage_name\", \"genres\"];\n\nconst albums = Albums.find(\n  {},\n  { fields: { name: 1, genres: 1, type: 1, added_at: 1, artists: 1 } }\n).fetch();\nconst arti = Artists.find(\n  {},\n  { fields: { stage_name: 1, type: 1, genres: 1, created_on: 1 } }\n).fetch();\nconst tracks = Tracks.find(\n  {},\n  {\n    fields: {\n      title: 1,\n      type: 1,\n      album: 1,\n      genres: 1,\n      featuring_artists: 1,\n      added_at: 1\n    }\n  }\n);\nasync function run() {\n  albums.forEach((el, index) => {\n    id = el._id;\n    delete el._id;\n    el.type = \"album\";\n    el.created_on = el.added_at;\n\n    el.artists = el.artists.map((el, ind) => {\n      return Artists.findOne({ _id: el }, { fields: { stage_name: 1 } });\n    });\n    delete el.added_at;\n\n    client.index(\n      {\n        id: id,\n        index: \"database1\",\n        type: \"_doc\",\n        body: el\n      },\n      function (err, res) {\n      }\n    );\n  });\n  arti.forEach((el, index) => {\n    id = el._id;\n    delete el._id;\n    el.created_on = new Date(\"2019-03-01\");\n    el.type = \"artist\";\n\n    client.index(\n      {\n        id: id,\n        index: \"database1\",\n        type: \"_doc\",\n        body: el\n      },\n      function (err, res) {\n        console.log(\"Well done\");\n      }\n    );\n  });\n\n  tracks.forEach((el, index) => {\n    id = el._id;\n    delete el._id;\n    el.created_on = el.added_at;\n    el.type = \"track\";\n    el.album_id = el.album;\n    let al = Albums.findOne(\n      { _id: el.album_id },\n      { fields: { name: 1, _id: 0, artists: 1 } }\n    );\n    el.album = al.name;\n\n    el.artists = al.artists.map((el, ind) => {\n      return Artists.findOne(\n        { _id: el },\n        { fields: { stage_name: 1, _id: 1 } }\n      );\n    });\n\n    el.featuring_artists = el.featuring_artists.map((el, ind) => {\n      return Artists.findOne(\n        { _id: el },\n        { fields: { stage_name: 1, _id: 1 } }\n      );\n    });\n\n    delete el.featuring_artists;\n    delete el.added_at;\n\n    client.index(\n      {\n        id: id,\n        index: \"database1\",\n        type: \"_doc\",\n        body: el\n      },\n      function (err, res) {\n        console.log(\"Track Added\");\n      }\n    );\n  });\n}\n//run().catch(err => console.log({ err }));\n","// Server entry point, imports all server code\nimport \"/imports/startup/server\";\nimport \"/imports/startup/both\";\nimport { MongoInternals } from \"meteor/mongo\";\nconst Busboy = Npm.require(\"busboy\");\nconst request = require(\"request\");\ntry {\n  const db1 = new MongoInternals.RemoteCollectionDriver(\n    Meteor.settings.accountsDB ? Meteor.settings.accountsDB.url : \"mongodb://localhost:3006/meteor\"\n    , {\n      reconnectTries: 120,\n      reconnectInterval: 10000,\n    }\n  );\n} catch (e) {\n\n}\n/*\n\nconst db1 = new MongoInternals.RemoteCollectionDriver(\n  \"mongodb+srv://theneighborhood:Nucb1bBBaGtbVig9@cluster0-lr63r.gcp.mongodb.net/theneighborhood?retryWrites=true&w=majority\"\n);\n\n*/\n\nimport { Markets, Albums } from \"/imports/api/collections.js\";\nimport { Tracks, Genres } from \"../imports/api/collections.js\";\n\nvar region;\nMeteor.publish(\"flowStart\", () => {\n  region = \"UA\";\n  return [Markets.find()];\n});\nMeteor.publish(\"markets\", () => {\n  return Markets.find({});\n});\n\nMeteor.onConnection(e => { });\n\nMeteor.methods({\n  createAccount(userId) {\n    if (Meteor.users.findOne({ tnid: userId })) {\n      return;\n    }\n    user = {};\n    user[\"tnid\"] = userId;\n    user[\"recently_played\"] = [];\n    user[\"settings\"] = {};\n    user[\"favorites\"] = [];\n    user[\"library\"] = [];\n\n    user[\"created_at\"] = new Date();\n    user[\"likes\"] = [];\n\n    return Meteor.users.insert(user, function (err, r) {\n      if (err) {\n\n      }\n    });\n  }\n});\n\nMeteor.publish(\"user\", function () {\n  if (this.userId) {\n    return Meteor.users.find({ _id: this.userId }, { fields: { services: 0 } });\n  }\n});\n\nWebApp.connectHandlers.use(\"/api/genres\", function (req, res, next) {\n  res.setHeader(\"Content-Type\", \"application/javascript\");\n  let gr = Genres.find().fetch();\n  //res.statusCode = 401;\n  res.end(JSON.stringify(gr));\n  //  next()\n});\n\nWebApp.connectHandlers.use(\"/uploadtrack\", function (req, res, next) {\n  console.log(req.url);\n\n  if (req.method.toLowerCase() == \"post\") {\n    var busboy = new Busboy({ headers: req.headers });\n    busboy.on(\"file\", function (fieldname, file, filename, encoding, mimetype) {\n      var id = makeid(10);\n      var cloudinary_stream = cloudinary.v2.uploader.upload_stream(\n        { resource_type: \"auto\", public_id: id, folder: \"releases\" },\n        function (err, ima) {\n\n          res.end(JSON.stringify(ima));\n        }\n      );\n\n      file.on(\"data\", function (data) {\n        cloudinary_stream.write(data);\n      });\n      file.on(\"end\", function () {\n        cloudinary_stream.end();\n      });\n    });\n    req.pipe(busboy);\n  } else {\n    next();\n  }\n});\nWebApp.connectHandlers.use(\"/upload/\", function (req, res, next) {\n  if (req.url == \"/cover\") {\n    next();\n  }\n  if (req.method.toLowerCase() == \"post\") {\n    var busboy = new Busboy({ headers: req.headers });\n\n    busboy.on(\"file\", function (fieldname, file, filename, encoding, mimetype) {\n      // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n      var id = makeid(10);\n\n      var cloudinary_stream = cloudinary.v2.uploader.upload_stream(\n        { resource_type: \"auto\", public_id: id, folder: \"uploads\" },\n        function (err, ima) {\n          res.end(JSON.stringify(ima));\n        }\n      );\n\n      file.on(\"data\", function (data) {\n        cloudinary_stream.write(data);\n      });\n      file.on(\"end\", function () {\n        cloudinary_stream.end();\n      });\n    });\n\n    req.pipe(busboy);\n  } else {\n    next();\n  }\n});\n\nWebApp.connectHandlers.use(\"/upload/cover\", function (req, res, next) {\n\n  if (req.method.toLowerCase() == \"post\") {\n    var busboy = new Busboy({ headers: req.headers });\n    busboy.on(\"file\", function (fieldname, file, filename, encoding, mimetype) {\n      // console.log('File [' + fieldname + ']: filename: ' + filename + ', encoding: ' + encoding + ', mimetype: ' + mimetype);\n      var id = makeid(10);\n      var cloudinary_stream = cloudinary.v2.uploader.upload_stream(\n        { resource_type: \"auto\", public_id: id, folder: \"/releases/coverarts\" },\n        function (err, ima) {\n          res.end(JSON.stringify(ima));\n        }\n      );\n\n      file.on(\"data\", function (data) {\n        cloudinary_stream.write(data);\n        //    console.log('File [' + fieldname + '] got ' + data.length + ' bytes');\n      });\n      file.on(\"end\", function () {\n        cloudinary_stream.end();\n      });\n    });\n\n    req.pipe(busboy);\n  } else {\n    next();\n  }\n});\n\nfunction makeid(length) {\n  var result = \"\";\n  var characters =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  var charactersLength = characters.length;\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n"]}